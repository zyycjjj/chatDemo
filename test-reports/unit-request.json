{"numTotalTestSuites":9,"numPassedTestSuites":4,"numFailedTestSuites":5,"numPendingTestSuites":0,"numTotalTests":14,"numPassedTests":6,"numFailedTests":8,"numPendingTests":0,"numTodoTests":0,"snapshot":{"added":0,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0,"didUpdate":false},"startTime":1767768537550,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["RequestClient","getMessages"],"fullName":"RequestClient getMessages 应该成功获取消息列表","status":"failed","title":"应该成功获取消息列表","duration":5.303082999999958,"failureMessages":["AssertionError: expected \"vi.fn()\" to be called with arguments: [ …(2) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st vi.fn() call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[2m    \"http://localhost:3001/api/messages?page=1&limit=20\",\u001b[22m\n\u001b[32m-   ObjectContaining {\u001b[90m\n\u001b[32m-     \"headers\": ObjectContaining {\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"headers\": {\u001b[90m\n\u001b[2m        \"Content-Type\": \"application/json\",\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[32m-     \"method\": \"GET\",\u001b[90m\n\u001b[31m+     \"signal\": AbortSignal {\u001b[90m\n\u001b[31m+       Symbol(kEvents): Map {},\u001b[90m\n\u001b[31m+       Symbol(events.maxEventTargetListeners): 0,\u001b[90m\n\u001b[31m+       Symbol(events.maxEventTargetListenersWarned): false,\u001b[90m\n\u001b[31m+       Symbol(kHandlers): Map {},\u001b[90m\n\u001b[31m+       Symbol(kAborted): false,\u001b[90m\n\u001b[31m+       Symbol(kReason): undefined,\u001b[90m\n\u001b[31m+       Symbol(kComposite): false,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[2m    },\u001b[22m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1420:10)\n    at Proxy.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1090:14)\n    at Proxy.methodWrapper (file:///Users/yangzhang/Desktop/chatDemo/node_modules/chai/index.js:1700:25)\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:43:28\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["RequestClient","getMessages"],"fullName":"RequestClient getMessages 应该支持before参数","status":"failed","title":"应该支持before参数","duration":0.9305839999999534,"failureMessages":["AssertionError: expected \"vi.fn()\" to be called with arguments: [ …(2) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st vi.fn() call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[32m-   \"http://localhost:3001/api/messages?before=2024-01-01T00:00:00Z\",\u001b[90m\n\u001b[32m-   Any<Object>,\u001b[90m\n\u001b[31m+   \"http://localhost:3001/api/messages?before=2024-01-01T00%3A00%3A00Z\",\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"headers\": {\u001b[90m\n\u001b[31m+       \"Content-Type\": \"application/json\",\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+     \"signal\": AbortSignal {\u001b[90m\n\u001b[31m+       Symbol(kEvents): Map {},\u001b[90m\n\u001b[31m+       Symbol(events.maxEventTargetListeners): 0,\u001b[90m\n\u001b[31m+       Symbol(events.maxEventTargetListenersWarned): false,\u001b[90m\n\u001b[31m+       Symbol(kHandlers): Map {},\u001b[90m\n\u001b[31m+       Symbol(kAborted): false,\u001b[90m\n\u001b[31m+       Symbol(kReason): undefined,\u001b[90m\n\u001b[31m+       Symbol(kComposite): false,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[31m+   },\u001b[90m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1420:10)\n    at Proxy.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1090:14)\n    at Proxy.methodWrapper (file:///Users/yangzhang/Desktop/chatDemo/node_modules/chai/index.js:1700:25)\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:69:28\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["RequestClient","getMessages"],"fullName":"RequestClient getMessages 应该处理网络错误","status":"failed","title":"应该处理网络错误","duration":1.5291659999999752,"failureMessages":["AssertionError: expected [Function] to throw error including '网络请求失败' but got 'Network error'\n    at _Assertion.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1485:16)\n    at _Assertion.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1090:14)\n    at _Assertion.methodWrapper (file:///Users/yangzhang/Desktop/chatDemo/node_modules/chai/index.js:1700:25)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1704:20\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:78:7\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["RequestClient","getMessages"],"fullName":"RequestClient getMessages 应该处理HTTP错误状态","status":"failed","title":"应该处理HTTP错误状态","duration":0.4027080000000183,"failureMessages":["AssertionError: expected [Function] to throw error including '请求失败: 500 Internal Server Error' but got 'Server error'\n    at _Assertion.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1485:16)\n    at _Assertion.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1090:14)\n    at _Assertion.methodWrapper (file:///Users/yangzhang/Desktop/chatDemo/node_modules/chai/index.js:1700:25)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1704:20\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:89:7\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["RequestClient","getMessages"],"fullName":"RequestClient getMessages 应该处理超时","status":"failed","title":"应该处理超时","duration":5004.313167,"failureMessages":["Error: STACK_TRACE_ERROR\n    at task (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:796:27)\n    at Object.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:823:16)\n    at Object.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:615:28)\n    at chain (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/chunk-tasks.js:9:14)\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:92:5\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:901:40\n    at runWithSuite (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1195:8)\n    at Object.collect (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:901:10)\n    at Object.collect (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:905:54)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.collect (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:905:46)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1390:26\n    at collectTests (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1365:3)\n    at startTests (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1937:17)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/vitest/dist/chunks/base.Bin-9uYm.js:86:26"],"meta":{}},{"ancestorTitles":["RequestClient","sendMessage"],"fullName":"RequestClient sendMessage 应该成功发送消息","status":"passed","title":"应该成功发送消息","duration":1.5053330000000642,"failureMessages":[],"meta":{}},{"ancestorTitles":["RequestClient","sendMessage"],"fullName":"RequestClient sendMessage 应该处理发送失败","status":"passed","title":"应该处理发送失败","duration":0.6512500000008004,"failureMessages":[],"meta":{}},{"ancestorTitles":["RequestClient","updateMessageStatus"],"fullName":"RequestClient updateMessageStatus 应该成功更新消息状态","status":"failed","title":"应该成功更新消息状态","duration":2.9222919999992882,"failureMessages":["AssertionError: expected \"vi.fn()\" to be called with arguments: [ …(2) ]\u001b[90m\n\nReceived: \n\n\u001b[1m  1st vi.fn() call:\n\n\u001b[22m\u001b[2m  [\u001b[22m\n\u001b[2m    \"http://localhost:3001/api/messages/1/status\",\u001b[22m\n\u001b[32m-   ObjectContaining {\u001b[90m\n\u001b[32m-     \"body\": \"{\\\"status\\\":\\\"delivered\\\"}\",\u001b[90m\n\u001b[32m-     \"headers\": ObjectContaining {\u001b[90m\n\u001b[31m+   {\u001b[90m\n\u001b[31m+     \"body\": \"\\\"delivered\\\"\",\u001b[90m\n\u001b[31m+     \"headers\": {\u001b[90m\n\u001b[2m        \"Content-Type\": \"application/json\",\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[2m      \"method\": \"PUT\",\u001b[22m\n\u001b[31m+     \"signal\": AbortSignal {\u001b[90m\n\u001b[31m+       Symbol(kEvents): Map {},\u001b[90m\n\u001b[31m+       Symbol(events.maxEventTargetListeners): 0,\u001b[90m\n\u001b[31m+       Symbol(events.maxEventTargetListenersWarned): false,\u001b[90m\n\u001b[31m+       Symbol(kHandlers): Map {},\u001b[90m\n\u001b[31m+       Symbol(kAborted): false,\u001b[90m\n\u001b[31m+       Symbol(kReason): undefined,\u001b[90m\n\u001b[31m+       Symbol(kComposite): false,\u001b[90m\n\u001b[31m+     },\u001b[90m\n\u001b[2m    },\u001b[22m\n\u001b[2m  ]\u001b[22m\n\u001b[39m\u001b[90m\n\nNumber of calls: \u001b[1m1\u001b[22m\n\u001b[39m\n    at Proxy.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1420:10)\n    at Proxy.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1090:14)\n    at Proxy.methodWrapper (file:///Users/yangzhang/Desktop/chatDemo/node_modules/chai/index.js:1700:25)\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:161:28\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["RequestClient","deleteMessage"],"fullName":"RequestClient deleteMessage 应该成功删除消息","status":"passed","title":"应该成功删除消息","duration":1.5047089999998207,"failureMessages":[],"meta":{}},{"ancestorTitles":["RequestClient","recallMessage"],"fullName":"RequestClient recallMessage 应该成功撤回消息","status":"passed","title":"应该成功撤回消息","duration":0.6949589999994714,"failureMessages":[],"meta":{}},{"ancestorTitles":["RequestClient","searchMessages"],"fullName":"RequestClient searchMessages 应该成功搜索消息","status":"passed","title":"应该成功搜索消息","duration":0.8685000000004948,"failureMessages":[],"meta":{}},{"ancestorTitles":["RequestClient","searchMessages"],"fullName":"RequestClient searchMessages 应该只传递非空参数","status":"passed","title":"应该只传递非空参数","duration":0.2983750000003056,"failureMessages":[],"meta":{}},{"ancestorTitles":["RequestClient","error handling"],"fullName":"RequestClient error handling 应该处理JSON解析错误","status":"failed","title":"应该处理JSON解析错误","duration":1.1235410000008414,"failureMessages":["AssertionError: expected [Function] to throw error including '数据解析失败' but got 'Invalid JSON'\n    at _Assertion.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1485:16)\n    at _Assertion.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1090:14)\n    at _Assertion.methodWrapper (file:///Users/yangzhang/Desktop/chatDemo/node_modules/chai/index.js:1700:25)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/expect/dist/index.js:1704:20\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:290:7\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:915:20"],"meta":{}},{"ancestorTitles":["RequestClient","error handling"],"fullName":"RequestClient error handling 应该处理AbortController超时","status":"failed","title":"应该处理AbortController超时","duration":5002.192375,"failureMessages":["Error: STACK_TRACE_ERROR\n    at task (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:796:27)\n    at Object.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:823:16)\n    at Object.<anonymous> (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:615:28)\n    at chain (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/chunk-tasks.js:9:14)\n    at /Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts:293:5\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:901:40\n    at runWithSuite (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1195:8)\n    at Object.collect (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:901:10)\n    at Object.collect (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:905:54)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.collect (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:905:46)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1390:26\n    at collectTests (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1365:3)\n    at startTests (file:///Users/yangzhang/Desktop/chatDemo/node_modules/@vitest/runner/dist/index.js:1937:17)\n    at file:///Users/yangzhang/Desktop/chatDemo/node_modules/vitest/dist/chunks/base.Bin-9uYm.js:86:26"],"meta":{}}],"startTime":1767768538004,"endTime":1767768548029.1924,"status":"failed","message":"","name":"/Users/yangzhang/Desktop/chatDemo/src/infrastructure/http/request.test.ts"}]}